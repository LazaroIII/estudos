<?php /*************** PHP LOGIN SCRIPT V 2.0************************************** Auto Approve Version**********************(c) Balakrishnan 2009. All Rights ReservedUsage: This script can be used FREE of charge for any commercial or personal projects.Limitations:- This script cannot be sold.- This script may not be provided for download except on its original site.For further usage, please contact me.***********************************************************///include 'dbc.php';$err = array();					 if($_POST['doRegister'] == 'Register') { /******************* Filtering/Sanitizing Input *****************************This code filters harmful script code and escapes data of all POST datafrom the user submitted form.*****************************************************************/foreach($_POST as $key => $value) {	$data[$key] = filter($value);}/************************ SERVER SIDE VALIDATION **************************************//********** This validation is useful if javascript is disabled in the browswer ***/if(empty($data['full_name']) || strlen($data['full_name']) < 4){$err[] = "ERRO - Nome inválido . Por favor, indique 3 ou mais caracteres para o seu nome";//header("Location: register.php?msg=$err");//exit();}// Validate User Nameif (!isUserID($data['user_name'])) {$err[] = "ERRO - nome de usuário inválido . Ele pode conter alfabeto, número e sublinhado.";//header("Location: register.php?msg=$err");//exit();}// Validate Emailif(!isEmail($data['usr_email'])) {$err[] = "ERRO - E-mail inválido.";//header("Location: register.php?msg=$err");//exit();}// Check User Passwordsif (!checkPwd($data['pwd'],$data['pwd2'])) {$err[] = "ERRO - senha ou incompatibilidade inválido . Digite 5 caracteres ou mais";//header("Location: register.php?msg=$err");//exit();}	  $user_ip = $_SERVER['REMOTE_ADDR'];// stores sha1 of password$sha1pass = PwdHash($data['pwd']);// Automatically collects the hostname or domain  like example.com) $host  = $_SERVER['HTTP_HOST'];$host_upper = strtoupper($host);$path   = rtrim(dirname($_SERVER['PHP_SELF']), '/\\');// Generates activation code simple 4 digit number$activ_code = rand(1000,9999);$usr_email = $data['usr_email'];$user_name = $data['user_name'];/************ USER EMAIL CHECK ************************************This code does a second check on the server side if the email already exists. It queries the database and if it has any existing email it throws user email already exists*******************************************************************/$rs_duplicate = mysql_query("select count(*) as total from users where user_email='$usr_email' OR user_name='$user_name'") or die(mysql_error());list($total) = mysql_fetch_row($rs_duplicate);if ($total > 0){$err[] = "ERRO - O nome de usuário / e-mail já existe. Por favor, tente novamente com o nome de usuário e e-mail diferente .";//header("Location: register.php?msg=$err");//exit();}/***************************************************************************/if(empty($err)) {$sql_insert = "INSERT into `users`  			(`full_name`,`user_email`,`pwd`,`address`,`tel`,`fax`,`website`,`date`,`users_ip`,`activation_code`,`country`,`user_name`			)		    VALUES		    ('$data[full_name]','$usr_email','$sha1pass','$data[address]','$data[tel]','$data[fax]','$data[web]'			,now(),'$user_ip','$activ_code','$data[country]','$user_name'			)			";			mysql_query($sql_insert,$link) or die("Insertion Failed:" . mysql_error());$user_id = mysql_insert_id($link);  $md5_id = md5($user_id);mysql_query("update users set md5_id='$md5_id' where id='$user_id'");//	echo "<h3>Thank You</h3> We received your submission.";if($user_registration)  {$a_link = "*****ACTIVATION LINK*****\nhttp://$host$path/activate.php?user=$md5_id&activ_code=$activ_code"; } else {$a_link = "A sua conta é * PENDENTE DE APROVAÇÃO * e será ativado em breve o administrador.";}$message = "Olá \nObrigado por registrar conosco. Aqui estão os detalhes de login...\nUser ID: $user_nameEmail: $usr_email \n Passwd: $data[pwd] \n$a_linkObrigadoAdministrator$host_upper______________________________________________________THIS IS AN AUTOMATED RESPONSE. ***DO NOT RESPOND TO THIS EMAIL****";	mail($usr_email, "Detalhes Login", $message,    "From: \"Member Registration\" <auto-reply@$host>\r\n" .     "X-Mailer: PHP/" . phpversion());  header("Location: thankyou.php");    exit();	 	 }  }					 ?><html xmlns="http://www.w3.org/1999/xhtml">  <head>    <meta http-equiv="Content-Type" content="text/xhtml; charset=UTF-8" />    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <meta name="description" content="">    <meta name="author" content="TECHNOLOGY CHECKER">    <meta name="keyword" content="PHP SCRIPT, CHECKER LOJAS, TESTADORES PRIV8, CHECKER CC, CONSULTAS">    <title>TECHNOLOGY CHECKER V3.0 - MADE IN BRAZIL PRIV8</title>    <link href="assets/css/bootstrap.css" rel="stylesheet">    <link href="assets/font-awesome/css/font-awesome.css" rel="stylesheet" />    <link href="assets/css/style.css" rel="stylesheet">    <link href="assets/css/style-responsive.css" rel="stylesheet"></head>  <script>  $(document).ready(function(){    $.validator.addMethod("username", function(value, element) {        return this.optional(element) || /^[a-z0-9\_]+$/i.test(value);    }, "Username must contain only letters, numbers, or underscore.");    $("#regForm").validate();  });  </script></head><body><table width="100%" border="0" cellspacing="0" cellpadding="5" class="main">  <tr>     <td colspan="3">&nbsp;</td>  </tr>  <tr>     <td width="160" valign="top"><p>&nbsp;</p>      <p>&nbsp; </p>      <p>&nbsp;</p>      <p>&nbsp;</p>      <p>&nbsp;</p></td>    <td width="732" valign="top"><p>	<?php 	 if (isset($_GET['done'])) { ?>	  <h2>Obrigado!</h2><a href="login.php">login here</a>";	 <?php exit();	  }	?></p>	      <h3 class="titlehdr">CADASTRAMENTO DE LOGIN</h3>      <p>O registro é rápido! Por favor, note que os campos marcados <span class="required">*</span>         São necessarios.</p>	 <?php		 if(!empty($err))  {	   echo "<div class=\"msg\">";	  foreach ($err as $e) {	    echo "* $e <br>";	    }	  echo "</div>";		   }	 ?> 	   <div class="main">		<div class="login-form">			<h1>CADASTRAMENTO</h1>			<form action="register.php" method="post" name="regForm" id="regForm" >        <table width="100%" border="0" cellpadding="3" cellspacing="3" class="forms">          <tr>             <td colspan="2">Nome<span class="required"><font color="#CC0000">*</font></span>              <input name="full_name" type="text" id="full_name" size="40" class="required"></td>          </tr>          <tr>             <td colspan="2">&nbsp;</td>          </tr>          <tr>             <td colspan="2">Cep<span class="required"><font color="#CC0000">*</font></span>			<input name="address" type="text" id="address" class="required"></td>          </tr>          <tr>             <td>Pais <font color="#CC0000">*</font></span>            <td>			</br>			<select name="country" class="required" id="select8">                <option value="" selected></option>                <option value="Brasil">Brasil</option>                </select></td>				</br>				</br>				</br>          </tr>		  </br>	       <tr>             <td>Telefone<span class="required"><font color="#CC0000">*</font></span>             </td>            <td><input name="tel" type="text" id="tel" class="required"></td>          </tr>          <tr>             <td>Fax </td>            <td><input name="fax" type="text" id="fax">			</td>          </tr>          <tr>             <td>Site </td>            <td><input name="web" type="text" id="web" class="optional defaultInvalid url">               <span class="example">http://www.example.com</span></td>          </tr>          <tr>             <td>Login<span class="required"><font color="#CC0000">*</font></span></td>            <td><input name="user_name" type="text" id="user_name" class="required username" minlength="5" >               <input name="btnAvailable" type="button" id="btnAvailable" 			  onclick='$("#checkid").html("Please wait..."); $.get("checkuser.php",{ cmd: "check", user: $("#user_name").val() } ,function(data){  $("#checkid").html(data); });'			  value="Check Availability"> 			    <span style="color:red; font: bold 12px verdana; " id="checkid" ></span>             </td>          </tr>          <tr>             <td>Email<span class="required"><font color="#CC0000">*</font></span>             </td>            <td><input name="usr_email" type="text" id="usr_email3" class="required email">           </tr>          <tr>             <td>Senha<span class="required"><font color="#CC0000">*</font></span>             </td>            <td><input name="pwd" type="password" class="required password" minlength="5" id="pwd">           </tr>          <tr>             <td>Confirme Senha<span class="required"><font color="#CC0000">*</font></span>             </td>            <td><input name="pwd2"  id="pwd2" class="required password" type="password" minlength="5" equalto="#pwd"></td>          </tr>          <tr>             <td colspan="2">&nbsp;</td>          </tr>        </table>        <p align="center">          <input name="doRegister" type="submit" id="doRegister" value="Register">        </p>      </form>      </td></table></body></html>